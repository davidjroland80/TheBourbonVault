<!--
Bourbon Tasting Tracker - single-file HTML (replace firebaseConfig with your project's values)

Setup steps (short):
1) Create a Firebase project at https://console.firebase.google.com
2) Enable Firestore (in test mode or configure rules) and optional Storage if you want images
3) From Project Settings -> SDK setup, copy the firebaseConfig object and paste below
4) Make sure Firestore rules allow reads/writes for your auth (this example uses anonymous auth by default)
   Example rule for development (NOT for production):
     service cloud.firestore {
       match /databases/{database}/documents {
         match /{document=**} { allow read, write: if true; }
       }
     }
5) Save this file to a GitHub repo and enable GitHub Pages on the repo (branch: main / folder: /) to host.
   Or use GitHub Actions to auto-deploy. No server code required.

What this page does:
- Uses Firebase (v9 modular) + Firestore to store tasting reviews
- Allows adding, editing, deleting reviews
- Live-syncs reviews (onSnapshot)
- Supports star rating, proof, distillery, date, tasting notes
- Uses anonymous auth so each browser gets its own user id (optional)

Replace the firebaseConfig placeholder with your project's config to run.
-->

<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Bourbon Tasting Tracker</title>
  <style>
    :root{--bg:#0f1724;--card:#0b1220;--muted:#9aa4b2;--accent:#d97706;--glass:rgba(255,255,255,0.03)}
    *{box-sizing:border-box}
    body{font-family:Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial; margin:0; background:linear-gradient(180deg,#071024 0%, #07192a 100%); color:#e6eef6; padding:28px}
    .app{max-width:980px;margin:0 auto}
    header{display:flex;align-items:center;gap:16px;margin-bottom:18px}
    h1{margin:0;font-size:20px}
    .grid{display:grid;grid-template-columns:360px 1fr;gap:18px}

    .card{background:var(--card);border-radius:12px;padding:16px;box-shadow:0 6px 18px rgba(2,6,23,0.6);}
    label{display:block;font-size:13px;color:var(--muted);margin-bottom:6px}
    input[type=text],input[type=date],input[type=number],textarea,select{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:var(--glass);color:inherit;font-size:14px}
    textarea{min-height:96px;resize:vertical}
    .row{display:flex;gap:8px}
    .btn{background:var(--accent);border:none;padding:10px 12px;border-radius:8px;color:#071024;font-weight:600;cursor:pointer}
    .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted)}
    .list{display:flex;flex-direction:column;gap:12px}
    .item{display:flex;gap:14px;align-items:flex-start;padding:12px;border-radius:10px;background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);border:1px solid rgba(255,255,255,0.02)}
    .meta{font-size:12px;color:var(--muted)}
    .stars{display:inline-block}
    .small{font-size:13px;color:var(--muted)}
    .actions{margin-left:auto;display:flex;gap:8px}
    .pill{background:rgba(255,255,255,0.03);padding:6px 8px;border-radius:999px;font-size:12px;color:var(--muted)}
    footer{margin-top:18px;color:var(--muted);font-size:13px}
    .empty{padding:26px;text-align:center;color:var(--muted);border-radius:10px;border:1px dashed rgba(255,255,255,0.04)}
  </style>
</head>
<body>
  <div class="app">
    <header>
      <img src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='44' height='44'><rect rx='8' ry='8' width='44' height='44' fill='%23D97706'/><text x='50%' y='58%' font-size='22' text-anchor='middle' fill='white' font-family='Arial' font-weight='700'>B</text></svg>" alt="logo" style="width:44px;height:44px;border-radius:8px;"/>
      <div>
        <h1>Bourbon Tasting Tracker</h1>
        <div class="small">Save tasting notes, proofs, ratings — live with Firebase</div>
      </div>
    </header>

    <div class="grid">
      <aside>
        <div class="card">
          <form id="reviewForm">
            <input type="hidden" id="reviewId" />
            <label for="distillery">Distillery / Brand</label>
            <input id="distillery" placeholder="e.g. Buffalo Trace" required />

            <label for="bottle">Bottle / Expression</label>
            <input id="bottle" placeholder="e.g. Single Oak Project #10" />

            <label for="proof">Proof</label>
            <input id="proof" type="number" placeholder="e.g. 101" />

            <label for="date">Tasting date</label>
            <input id="date" type="date" />

            <label for="rating">Rating (1–10, allow decimals)</label>
<input id="rating" type="number" min="1" max="10" step="0.1" placeholder="e.g. 8.5" />

            <label for="notes">Tasting notes</label>
            <textarea id="notes" placeholder="Nose:... Palate:... Finish:..."></textarea>

            <div style="display:flex;gap:8px;margin-top:12px">
              <button type="submit" class="btn">Save review</button>
              <button type="button" id="clearBtn" class="btn ghost">Clear</button>
            </div>
          </form>

          <hr style="margin:16px 0;border:none;border-top:1px solid rgba(255,255,255,0.02)" />
          <div class="small">Sync status: <span id="status">—</span></div>
          <div class="small" style="margin-top:6px">User ID: <span id="uid">—</span></div>
        </div>
      </aside>

      <main>
        <div class="card">
          <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:12px">
            <div style="display:flex;gap:8px;align-items:center">
              <input id="search" placeholder="Filter by distillery, bottle, or notes" style="padding:8px;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.04);min-width:260px;color:inherit" />
              <select id="sort">
                <option value="dateDesc">Newest first</option>
                <option value="dateAsc">Oldest first</option>
                <option value="ratingDesc">Highest Score</option>
                <option value="ratingAsc">Lowest Score</option>
              </select>
            </div>
            <div class="pill">Total: <span id="count">0</span></div>
          </div>

          <div id="list" class="list">
            <div class="empty">No reviews yet — add one on the left.</div>
          </div>
        </div>

        <footer>
          Deployed via GitHub Pages — replace firebaseConfig, enable Firestore, and optionally secure rules for production.
        </footer>
      <section class="card" style="margin-top:20px">
  <h2 style="margin-top:0">Ratings Overview</h2>
  <canvas id="ratingChart" height="120"></canvas>
</section>
</main>
    </div>
  </div>

  <!-- Firebase v9 modular CDN -->
  <script type="module">
    // ---------- 1) Paste your firebaseConfig here ----------
    const firebaseConfig = {
      apiKey: "AIzaSyAWhivu2HR_6epguOnwxvu7Nfsu1OYKESA",
      authDomain: "bourbon-vault.firebaseapp.com",
      databaseURL: "https://bourbon-vault-default-rtdb.firebaseio.com",
      projectId: "bourbon-vault",
      storageBucket: "bourbon-vault.firebasestorage.app",
      messagingSenderId: "1013190214804",
      appId: "1:1013190214804:web:594665cae3a79a3451a081"
    };
    // -------------------------------------------------------

    // Firebase imports (CDN)
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js';
    import { getFirestore, collection, addDoc, onSnapshot, doc, deleteDoc, updateDoc, query, orderBy, serverTimestamp, getDocs } from 'https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js';
    import { getAuth, signInAnonymously, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/9.22.2/firebase-auth.js';

    // Initialize
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);

    // UI refs
    const reviewForm = document.getElementById('reviewForm');
    const distilleryInput = document.getElementById('distillery');
    const bottleInput = document.getElementById('bottle');
    const proofInput = document.getElementById('proof');
    const dateInput = document.getElementById('date');
    const ratingInput = document.getElementById('rating');
    const notesInput = document.getElementById('notes');
    const listEl = document.getElementById('list');
    const statusEl = document.getElementById('status');
    const uidEl = document.getElementById('uid');
    const countEl = document.getElementById('count');
    const reviewIdInput = document.getElementById('reviewId');
    const searchInput = document.getElementById('search');
    const sortSelect = document.getElementById('sort');
    const clearBtn = document.getElementById('clearBtn');

    // Anonymous auth so users get a stable uid per browser session/device
    signInAnonymously(auth).catch((err)=>console.error('Auth error',err));
    onAuthStateChanged(auth, user=>{
      if(user){ uidEl.textContent = user.uid; }
    });

    // Collection reference
    const reviewsCol = collection(db, 'reviews');

    // Keep an in-memory map of reviews for filtering/sorting
    let reviews = [];

    // Listen for real-time updates (ordered by timestamp desc)
    const q = query(reviewsCol, orderBy('createdAt','desc'));
    const unsub = onSnapshot(q, snapshot=>{
      statusEl.textContent = 'Synced';
      reviews = snapshot.docs.map(docSnap => ({ id: docSnap.id, ...docSnap.data() }));
      renderList();
    }, err=>{
      console.error(err);
      statusEl.textContent = 'Error';
    });

    // Render list with filtering and sorting
    function renderList(){
      const qText = searchInput.value.trim().toLowerCase();
      let filtered = reviews.filter(r=>{
        if(!qText) return true;
        return (r.distillery||'').toLowerCase().includes(qText) || (r.bottle||'').toLowerCase().includes(qText) || (r.notes||'').toLowerCase().includes(qText);
      });

      const sort = sortSelect.value;
      if(sort==='dateDesc') filtered.sort((a,b)=> (b.createdAt?.seconds||0) - (a.createdAt?.seconds||0));
      if(sort==='dateAsc') filtered.sort((a,b)=> (a.createdAt?.seconds||0) - (b.createdAt?.seconds||0));
      if(sort==='ratingDesc') filtered.sort((a,b)=> (b.rating||0) - (a.rating||0));
      if(sort==='ratingAsc') filtered.sort((a,b)=> (a.rating||0) - (b.rating||0));

      countEl.textContent = filtered.length;

      if(filtered.length===0){
        listEl.innerHTML = '<div class="empty">No reviews match your filter.</div>';
        return;
      }

      listEl.innerHTML = '';
      for(const r of filtered){
        const item = document.createElement('div'); item.className='item';
        const left = document.createElement('div'); left.style.flex='0 0 10px';
        const body = document.createElement('div'); body.style.flex='1';

        const title = document.createElement('div'); title.style.fontWeight='700'; title.textContent = (r.bottle ? r.bottle + ' — ' : '') + (r.distillery || 'Unknown');
        const meta = document.createElement('div'); meta.className='meta';
        const dateStr = r.date ? new Date(r.date).toLocaleDateString() : (r.createdAt ? new Date(r.createdAt.seconds*1000).toLocaleDateString() : '—');
        meta.textContent = `Score: ${r.rating||0}/10 · ${dateStr} · ${r.proof ? r.proof + ' proof' : 'proof N/A'}`;

        const notes = document.createElement('div'); notes.style.marginTop='6px'; notes.textContent = r.notes || '';

        const actions = document.createElement('div'); actions.className='actions';
        const editBtn = document.createElement('button'); editBtn.className='btn ghost'; editBtn.textContent='Edit';
        const delBtn = document.createElement('button'); delBtn.className='btn ghost'; delBtn.textContent='Delete';

        editBtn.onclick = ()=>{ populateFormForEdit(r); };
        delBtn.onclick = async ()=>{
          if(!confirm('Delete this review?')) return;
          try{ await deleteDoc(doc(db, 'reviews', r.id)); }catch(e){alert('Delete failed: '+e.message)}
        };

        actions.appendChild(editBtn); actions.appendChild(delBtn);

        const bar = document.createElement('div'); bar.style.height='6px'; bar.style.borderRadius='4px'; bar.style.background='rgba(255,255,255,0.08)'; bar.style.marginTop='4px';
        const fill = document.createElement('div'); fill.style.height='100%'; fill.style.width=`${(r.rating||0)*10}%`; fill.style.borderRadius='4px'; fill.style.background='var(--accent)'; bar.appendChild(fill);
        body.appendChild(title); body.appendChild(meta); body.appendChild(bar); body.appendChild(notes);
        item.appendChild(body); item.appendChild(actions);
        listEl.appendChild(item);
      }
    }

    function populateFormForEdit(r){
      reviewIdInput.value = r.id;
      distilleryInput.value = r.distillery || '';
      bottleInput.value = r.bottle || '';
      proofInput.value = r.proof || '';
      dateInput.value = r.date ? new Date(r.date).toISOString().slice(0,10) : '';
      ratingInput.value = r.rating || 3;
      notesInput.value = r.notes || '';
      window.scrollTo({top:0,behavior:'smooth'});
    }

    reviewForm.addEventListener('submit', async (e)=>{
      e.preventDefault();
      const data = {
        distillery: distilleryInput.value.trim(),
        bottle: bottleInput.value.trim(),
        proof: proofInput.value ? Number(proofInput.value) : null,
        date: dateInput.value || null,
        rating: Number(ratingInput.value),
        notes: notesInput.value.trim(),
        updatedAt: serverTimestamp()
      };
      const id = reviewIdInput.value;
      try{
        if(id){
          await updateDoc(doc(db, 'reviews', id), data);
        } else {
          await addDoc(reviewsCol, {...data, createdAt: serverTimestamp()});
        }
        reviewForm.reset(); reviewIdInput.value='';
      }catch(err){
        console.error(err); alert('Save failed: '+err.message);
      }
    });

    clearBtn.addEventListener('click', ()=>{ reviewForm.reset(); reviewIdInput.value=''; });
    searchInput.addEventListener('input', ()=>renderList());
    sortSelect.addEventListener('change', ()=>renderList());

    // Helpful: fetch existing docs once on load (optional)
    async function initOnce(){
      try{ statusEl.textContent='Loading...';
        const snaps = await getDocs(q);
        // onSnapshot will update after this anyway
      }catch(e){ console.warn(e); }
    }
    initOnce();

    // Clean up when unloading (optional)
    window.addEventListener('beforeunload', ()=>{ if(typeof unsub === 'function') unsub(); });
    // --- Image Upload Support ---
  import { getStorage, ref as storageRef, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/9.6.11/firebase-storage.js";

  const storage = getStorage(app);

  // Add image input to the form
  const form = document.getElementById('review-form');
  if (!document.getElementById('image-input')) {
    const imgInput = document.createElement('input');
    imgInput.type = 'file';
    imgInput.accept = 'image/*';
    imgInput.id = 'image-input';
    imgInput.className = 'mt-2';
    form.appendChild(imgInput);
  }

  // Modify submit handler to upload an image
  form.addEventListener('submit', async (e) => {
    e.preventDefault();

    const file = document.getElementById('image-input').files[0];
    let imageUrl = null;

    if (file) {
      const filePath = `bourbon_images/${Date.now()}_${file.name}`;
      const imgRef = storageRef(storage, filePath);
      const snapshot = await uploadBytes(imgRef, file);
      imageUrl = await getDownloadURL(snapshot.ref);
    }

    // Attach imageUrl to the review object
    review.imageUrl = imageUrl;
  });
// --- Charts (Chart.js) ---
import "https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js";

function renderChart(){
  const ctx = document.getElementById('ratingChart');
  if(!ctx) return;
  const bins = Array(10).fill(0);
  for(const r of reviews){ if(r.rating>=1 && r.rating<=10) bins[r.rating-1]++; }
  if(window.ratingChart) window.ratingChart.destroy();
  window.ratingChart = new Chart(ctx,{
    type:'bar',
    data:{ labels:[1,2,3,4,5,6,7,8,9,10], datasets:[{ label:'Count', data:bins }] },
    options:{ responsive:true, plugins:{legend:{display:false}}, scales:{y:{beginAtZero:true}} }
  });
}

// Re-render chart whenever list updates
const originalRenderList = renderList;
renderList = function(){ originalRenderList(); renderChart(); };

</script>
</body>
</html>
